<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/cancion.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <title>Canción</title>
</head>

<body>
    <header>
        <nav>
            <h2>El universo musical</h2>
            <a href="index.html">Home</a>
            <a href="sobreNosotros.html">About us</a>
            <a href="soporte.html">Soporte</a>
            <a href="busqueda.html">Busqueda</a>
            <a href="log_in.html">log in</a>
        </nav>
    </header>
    <div>
        <h2 id="titulo">Maps</h2>
        <main class="flex-row center">
            <div id="video-container">
                <!-- Aquí se insertará el iframe si hay clip_url -->
            </div>

            <div id="info">
                <h3>Genero:</h3>
                <p id="genero">DEFAULT</p>
    
                <h3>Artista:</h3>
                <a id="link-artista" href="#">DEFAULT</a>
    
                <h3>Released</h3>
                <p id="release-year"></p><br><br>
            </div>

        </main>
        <section>

            <h3 id="historia_titu">Historia</h3>
            <hr>
            <p id="historia">Todo empezó en entre el 2001 y 2002, cuando el trío neoyorquino lanzó dos EP’s; uno homónimo y otro
                titulado Machine. El éxito llegó muy rápido para la banda provocando así que tuvieran que salir de gira
                para promocionar sus canciones. En dicho tour, los Yeah Yeah Yeahs fueron acompañados por Liars, una
                banda australiana liderada por Angus Andrew, quien tiempo después se hizo novio de Karen O.</p>
            <p>

        </section>

        <section>
            <h3>Letra: </h3>
            <hr>
            <p>
                OverviewLyricsListenArtists
                Lyrics
                Pack up
                I'm straight
                Enough
                Oh, say, say, say
                Oh, say, say, say
                Oh, say, say, say
                Oh, say, say, say
                Oh, say, say, say
                Wait, they don't love you like I love you
                Wait, they don't love you like I love you
                Maps
                Wait, they don't love you like I love you
                Made off
                Don't stray
                Well, my kind's your kind
                I'll stay the same
                Pack up
                Don't stray
                Oh, say, say, say
                Oh, say, say, say
                Wait, they don't love you like I love you
                Wait, they don't love you like I love you
                Maps
                Wait, they don't love you like I love you
                Wait, they don't love you like I love you
                Maps
                Wait, they don't love you like I love you
                Wait, they don't love you like I love you
                Wait, they don't love you like I love you
                Maps
                Wait, they don't love you like I love you
                Wait, they don't love you like I love you
                Maps
                Wait, they don't love you like I love you
                Source: LyricFind
            </p>
        </section>

        <section id="albumes_po">
            <h3 id="album-nombre">Álbum: Fever To Tell</h3>
            <img  id="album-img" src="img/Yeah_Yeah_Yeahs_-_Fever_to_Tell.png">
        </section>
        <section id="estadisticas">
            <h3>Estadistcas</h3>
            <p id="reproducciones">Número de reproducciones: DEFAULT</p>
        </section>
    </div>
    <footer>
        <div class="footer-content">
            <p>© 2025 El universo musical</p>
            <div class="social-icons">
                <a href="#" target="_blank" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" target="_blank" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                <a href="#" target="_blank" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                <a href="#" target="_blank" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
            </div>
        </div>
    </footer>
</body>
</html>

<script>
    const params = new URLSearchParams(window.location.search);
const songId = params.get('id');

if (songId) {
  fetch(`/api/songs?id=${songId}`)
    .then(res => {
      if (!res.ok) throw new Error('No se pudo obtener la canción');
      return res.json();
    })
    .then(async ([song]) => {
      // Rellenar campos básicos
      document.getElementById('titulo').textContent = song.title || 'DEFAULT';
      document.getElementById('genero').textContent = song.genre || 'DEFAULT';
      document.getElementById('release-year').textContent = `${song.release_year || 'DEFAULT'}`;
      document.getElementById('historia').innerHTML = song.story
        ? `<p>${song.story}</p>`
        : '<p>DEFAULT</p>';

      document.getElementById('reproducciones').innerHTML = `Número de reproducciones: <strong>${song.play_count?.toLocaleString('es-ES') || 'DEFAULT'}</strong>`;

      // Obtener datos de artista
      const artistaLink = document.getElementById('link-artista');
      if (song.artist_id) {
        const artistaRes = await fetch(`/api/artists?id=${song.artist_id}`);
        const artista = await artistaRes.json();
        artistaLink.textContent = artista[0]?.stage_name || 'DEFAULT';
        artistaLink.href = `detalle_artistas.html?id=${song.artist_id}`;
      } else {
        artistaLink.textContent = 'DEFAULT';
        artistaLink.href = '#';
      }

      // Obtener datos del álbum
      if (song.album_id) {
        const albumRes = await fetch(`/api/albums?id=${song.album_id}`);
        const album = await albumRes.json();
        document.getElementById('album-nombre').textContent = `Álbum: ${album[0]?.name || 'DEFAULT'}`;
        document.getElementById('album-img').src = album[0]?.photo_url || 'img/default_album.png';
      } else {
        document.getElementById('album-nombre').textContent = 'Álbum: DEFAULT';
        document.getElementById('album-img').src = 'img/default_album.png';
      }

      const clipUrl = song.clip_url;

    if (clipUrl && clipUrl.includes('youtube.com') || clipUrl.includes('youtu.be')) {
    const videoId = extractYoutubeId(clipUrl);

    if (videoId) {
        const iframe = document.createElement('iframe');
        iframe.width = "560";
        iframe.height = "315";
        iframe.src = `https://www.youtube.com/embed/${videoId}`;
        iframe.title = "YouTube video player";
        iframe.frameBorder = "0";
        iframe.allow =
        "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
        iframe.allowFullscreen = true;

        document.getElementById('video-container').appendChild(iframe);
    }
    }

    })
    .catch(err => {
      console.error('Error al cargar la canción:', err);
      document.body.innerHTML = '<p>Error al cargar los detalles de la canción.</p>';
    });
} else {
  document.body.innerHTML = '<p>ID de canción no especificado en la URL.</p>';
}


function extractYoutubeId(url) {
  const regExp =
    /^.*(youtu\.be\/|v=|\/embed\/|shorts\/)([^#&?]*).*/;
  const match = url.match(regExp);
  return match && match[2].length === 11 ? match[2] : null;
}

</script>